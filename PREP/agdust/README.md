## Calmap

### Description

The preprocessor program Calmap produces gridded planting start dates, planting end dates, and harvesting end dates for different crop types for estimating the impacts of agricultural activities on windblown dust emissions. The CMAQ windblown dust emissions module can optionally use the output from Calmap to simulate the effects of crop cycles on dust emissions.

### Files, configuration, and environment variables
Calmap reads five input files to produce eight outputs, only three of which are used by the CCTM. Calmap uses the GRIDCRO2D file, produced by MCIP, to define the modeling grid. The BELD01 file points to a BELD3 “a” file of gridded land cover/land use data containing coverage for several different crop categories. The BELD3 “a” file is an input to the BEIS emissions model and can be [generated by the Spatial Allocator](https://github.com/CMASCenter/Spatial-Allocator/blob/master/docs/User_Manual/SA_ch03_vector.md#5-creating-inputs-to-smoke-biogenic-processing). The rest of the inputs to Calmap are crop calendar data for the United States that are packaged with CMAQv5. Calmap converts to the data to I/O API GRDDED3 files on the modeling grid defined in the GRIDCRO2D file. The CROPMAP01 file contains planting start dates for specific crops. The CROPMAP04 file contains planting end dates for specific crops. The CROPMAP08 file contains harvesting end dates for specific crops. Each of these files are input to the CCTM when the erodible agricultural land (CTM_ERODE_AGLAND) feature is turned on.

<a id=Figure7-3></a>

![](./images/Figure7-3.png "Figure7-3.png")

**Figure 7‑3. Calmap input and output files**

#### Calmap input files

**Table 7‑3. Calmap input files**

|**File Name**|**Format**|**Description**|
|-------------|----------|---------------------------------------------------------|
|GRID_CRO_2D|GRDDED3|Name and location of the time-independent 2-D cross-point meteorology file; output by MCIP|
|BELD01|GRDDED3|BELD land use “A” data file for calculating windblown dust emissions; produced with BELD land use tiles and the Spatial Allocator|
|CPCALED|ASCII|Calendar of agricultural activities by state|
|NCROP|ASCII|Number and names of crop species included in the crop calendar|
|USSTATE|ASCII|Two digit US state codes included in the crop calendar|

#### Calmap output files

**Table 7‑4. Calmap output files**

|**File Name**|**Format**|**Description**|
|-----------|---------|-------------------------------------------------------|
|CROPMAP01|GRDDED3|Name and location of the gridded planting start dates file.|
|CROPMAP02|GRDDED3|Name and location of the gridded ??? start dates file; not used by the CCTM.|
|CROPMAP03|GRDDED3|Name and location of the gridded ??? dates file; not used by the CCTM|
|CROPMAP04|GRDDED3|Name and location of the gridded planting end dates file.|
|CROPMAP05|GRDDED3|Name and location of the gridded ??? start dates file; not used by the CCTM|
|CROPMAP06|GRDDED3|Name and location of the gridded ??? start dates file; not used by the CCTM|
|CROPMAP07|GRDDED3|Name and location of the gridded harvesting end dates file.|

#### Execution Configuration Variables ####

The environment variables listed here are invoked during execution of the program and are set in the Calmap run script.

```
-   BASE: [default: $CMAQ_HOME/PREP/agdust/scripts] Base Calmap installation location.
-   GRID_CRO_2D: [default: none] Directory path and name of the GRID_CRO_2D file for defining the modeling grid.
-   BELD01: [default: none] Directory path and name of the BELD3 A file for defining the gridded land cover,land use in the modeling domain. Note that this is the same file used by the CCTM to compute dust emissions (DUST_LU_1).
-   CROPMAP01-08: [default: none] Directory path and names of Calmap output files. The CROPMAP01, CROPMAP04, and CROPMAP08 are the only files used by the CCTM for the dust calculation.
```

### Compiling and Running

#### Compile Calmap

Calmap is compiled with a Makefile. The configuration options in the Makefile include only the compiler and compiler flags to use for building the executable. The Makefile is located in the directory with the Calmap source code `$CMAQ_HOME/PREP/agdust/src`. To compile Calmap, source the config_cmaq.csh file and invoke the Makefile at the command line.

```
cd $CMAQ_HOME/PREP/agdust/src
source $CMAQ_HOME/config_cmaq.csh
./make |& tee make.calmap.log
```

To port Calmap to different compilers, change the compiler names, locations, and flags in the config.cmaq script.

#### Run Calmap ####

Set the run script settings according to the execution configuration variables described above. Run Calmap to produce crop calendar input for the CCTM inline windblown dust model:

```
cd $CMAQ_HOME/PREP/agdust/scripts
./run_calmap.csh |& tee run_calmap.log
```

--------
